---
# Please do not edit this file directly; it is auto generated.
# Instead, please edit 04-assumptionsAndFit.md in _episodes_rmd/
source: Rmd
title: "Assessing multiple linear regression model fit and assumptions"
objectives:
  - Use the adjusted R squared value as a measure of model fit.
  - Assess whether the assumptions of the multiple linear regression model have been violated.
keypoints:
questions:
teaching: 10
execises: 10
---



In this episode we will check the fit and assumptions of multiple linear 
regression models. We will use the extension to $R^2$ for multiple linear 
regression models, the adjusted $R^2$ ($R^2_{adj}$). We will also learn
to assess the six linear regression assumptions in the case of 
multiple linear regression.

## Measuring fit using $R^2_{adj}$
In the simple linear regression [episode](https://carpentries-incubator.github.io/simple-linear-regression-public-health/06-fitAndAssumptionSLR) 
on model assumptions we learned that $R^2$ quantifies 
the proportion of variation in the outcome variable explained by the 
explanatory variable. In the context of multiple linear regression, a
caveat emerges to $R^2$: adding explanatory variables to our model will
almost always increase $R^2$, even if the explanatory variables do not
have relationships with the response variable. Therefore, when interpreting
the output from `summ()`, look at the $R^2_{adj}$. This is an $R^2$ corrected
for the number of variables in the model. In some cases, the adjusted and
unadjusted metrics will be (near) equal. In other cases, the differences
will be larger. 

>## Exercise
>Find the adjusted R-squared value for the `summ` output of our `Hemoglobin_Age_Sex` model from 
>[episode 2](carpentries-incubator.github.io/multiple-linear-regression-public-health/02-contAndCatInt/).
>What proportion of variation in hemoglobin is explained by age, sex and their interaction in our model? 
>Does our model account for most of the variation in `Hemoglobin`?
> > ## Solution
> > 
> > ~~~
> > Hemoglobin_Age_Sex <- dat %>%
> >   filter(Age > 17) %>%
> >   lm(formula = Hemoglobin ~ Age * Sex)
> > 
> > summ(Hemoglobin_Age_Sex, confint = TRUE, digits = 3)
> > ~~~
> > {: .language-r}
> > 
> > 
> > 
> > ~~~
> > MODEL INFO:
> > Observations: 5995 (502 missing obs. deleted)
> > Dependent Variable: Hemoglobin
> > Type: OLS linear regression 
> > 
> > MODEL FIT:
> > F(3,5991) = 1026.313, p = 0.000
> > R² = 0.339
> > Adj. R² = 0.339 
> > 
> > Standard errors: OLS
> > --------------------------------------------------------------
> >                       Est.     2.5%    97.5%    t val.       p
> > ----------------- -------- -------- -------- --------- -------
> > (Intercept)         13.294   13.175   13.413   219.699   0.000
> > Age                  0.001   -0.001    0.003     0.684   0.494
> > Sexmale              2.757    2.587    2.927    31.852   0.000
> > Age:Sexmale         -0.023   -0.026   -0.020   -13.938   0.000
> > --------------------------------------------------------------
> > ~~~
> > {: .output}
> > 
> > Since $R^2_{adj} = 0.339$, our model accounts for approximately 34% of the variation in
> > `Hemoglobin`. Our model explains 34% of the variation in `Hemoglobin`, which
> > a model that always predicts the mean would not. 
> {: .solution}
{: .challenge}

## Assessing the assumptions of the multiple linear regression model
We learned to assess six assumptions in the simple linear regression [episode](https://carpentries-incubator.github.io/simple-linear-regression-public-health/06-fitAndAssumptionSLR) 
on model assumptions. These assumptions also hold in the multiple linear 
regression context, although in some cases their assessment is a little more 
extensive. Below we will practice assessing these assumptions. 

### Validity
Recall that the validity assumption states that the model is appropriate 
for the research question. Validity is assessed through three questions:

A) Does the outcome variable reflect the *phenomenon of interest*?  
B) Does the model include *all relevant explanatory variables*?     
C) Does the model generalise to our *case of interest*?  

>## Exercise
> You are asked to use the `FEV1_Age_SmokeNow` model to answer the following research question:  
> 
> "Does the effect of age on FEV1 differ by smoking status in US adults?"  
> 
> Using the three points above, assess the validity of this model for
> the research question. 
> > ## Solution
> A) The research question is on FEV1, which is our outcome variable. Therefore our outcome variable reflects the phenomenon of interest.   
> B) Our research question asks whether the effect of age differs by smoking status, which can be tested using an interaction between `Age` and `SmokeNow`. Since our model does not include this interaction, our model does not include all relevant explanatory variables.    
> C) Since the NHANES data was collected from individuals in the US, our model should generalise to our case of interest.  
> {: .solution}
{: .challenge}

### Representativeness
Recall that the representativeness assumption states that the sample is 
representative of the population to which we are generalising our findings. This
assumption is assessed in the same way as for the case of the simple linear
regression model, so we will go through another exercise at this point. 

### Linearity and additivity
Recall that this assumption states that our outcome variable has a linear, 
additive relationship with the explanatory variables. 

The linearity component is assessed in the same way as in the simple
linear regression case. For example, recall that the relationship between
combined diastolic blood pressure (`BPDiaAve`) and age in months (`AgeMonths`)
was curved. Adding a squared term to the model helped us to model this
non-linear relationship. We can add a `Sex` term to fit separate
non-linear curves to this data:


~~~
BPDiaAve_AgeMonthsSQ_Sex <- lm(BPDiaAve ~ AgeMonths + I(AgeMonths^2) + Sex, data = dat)
interact_plot(BPDiaAve_AgeMonthsSQ_Sex, pred = AgeMonths, modx = Sex,
            plot.points = TRUE, interval = TRUE,
            point.size = 0.7) +
  ylab("Combined diastolic blood pressure") +
  xlab("Age in Months") 
~~~
{: .language-r}

<img src="../fig/rmd-04-non-linear interaction BPDiaAve AgeMonths Sex-1.png" title="plot of chunk non-linear interaction BPDiaAve AgeMonths Sex" alt="plot of chunk non-linear interaction BPDiaAve AgeMonths Sex" width="612" style="display: block; margin: auto;" />

The non-linear relationship has now been modeled separately for levels
of a categorical variable. 

Recall that the additivity component of the linearity and additivity assumption 
means that the effect of any explanatory variable on the outcome variable does 
not depend on another explanatory variable in the model. In other words, that 
our model includes all necessary interactions between explanatory variables. 
In the above example, the additivity component does not appear to be violated:
it does not look like the data requires an interaction between age and sex. 



~~~
residualData <- tibble(resid = resid(BPSysAve_Age_Sex),
                    fitted = fitted(BPSysAve_Age_Sex),
                    height = BPSysAve_Age_Sex$model$Age,
                    sex = BPSysAve_Age_Sex$model$Sex)
~~~
{: .language-r}



~~~
Error in resid(BPSysAve_Age_Sex): object 'BPSysAve_Age_Sex' not found
~~~
{: .error}



~~~
p1 <- ggplot(residualData, aes(x = fitted, y = resid)) +
  geom_point(alpha = 0.1) +
  geom_smooth()
~~~
{: .language-r}



~~~
Error in ggplot(residualData, aes(x = fitted, y = resid)): object 'residualData' not found
~~~
{: .error}



~~~
p2 <- ggplot(residualData, aes(x = height, y = resid)) +
  geom_point(alpha = 0.1) +
  geom_smooth()
~~~
{: .language-r}



~~~
Error in ggplot(residualData, aes(x = height, y = resid)): object 'residualData' not found
~~~
{: .error}



~~~
p3 <- ggplot(residualData, aes(x = sex, y = resid)) +
  geom_violin() + 
  geom_jitter(alpha = 0.1, width = 0.2) 
~~~
{: .language-r}



~~~
Error in ggplot(residualData, aes(x = sex, y = resid)): object 'residualData' not found
~~~
{: .error}



~~~
p1 + p2 + p3
~~~
{: .language-r}



~~~
Error in eval(expr, envir, enclos): object 'p1' not found
~~~
{: .error}
